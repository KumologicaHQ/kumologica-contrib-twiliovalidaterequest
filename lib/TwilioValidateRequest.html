<script type="text/javascript">
  App.nodes.registerType('TwilioValidateRequest', {
    category: 'platforms',
    color: '#DC143C',
    defaults: {
      name: { value: 'TwilioValidateRequest', required: true },
      message: { value: '', templateable: true },
      twilioSignature: { value: '', templateable: true, required: true },
      url: { value: '', templateable: true, required: true },
      twilioauthtoken: { value: '', templateable: true, required: true }
    },
    inputs: 1,
    outputs: 1,
    icon: 'kumo_twilio.png',
    label: function () {
      return this.name || 'TwilioValidateRequest';
    },
  });
</script>

<script type="text/x-kumologica" data-template-name="TwilioValidateRequest">
    <div class="kumo-window">

      <!-- Display name -->
      <div class="kumo-section">
        <div class="kumo-row">
            <label class="kumo-row-label" for="node-input-name">Display Name</label>
            <input class="kumo-row-editable" type="text" id="node-input-name" placeholder="Node Name">
        </div>
      </div>

      <!-- General section -->
      <div class="kumo-section-title">General</div>
        <div class="kumo-section">

          <div id="AttrHolder">
          <div class="kumo-row" id='Message'>
            <div class="kumo-row-with-margin">
              <label class="kumo-row-label" for="node-input-message">Message</label>
              <input class="kumo-row-editable" type="text" id="node-input-message" placeholder="Inbound message from Twilio">
            </div>
          </div>
          <div class="kumo-row" id='Signature'>
            <div class="kumo-row-with-margin" >
              <label class="kumo-row-label" for="node-input-twilioSignature">Signature</label>
              <input class="kumo-row-editable" type="text" id="node-input-twilioSignature" placeholder="Signature send on request header">
            </div>
          </div>
          <div class="kumo-row" id='twilioauthtoken'>
            <div class="kumo-row-with-margin" >
              <label class="kumo-row-label" for="node-input-twilioauthtoken">Auth Token</label>
              <input class="kumo-row-editable" type="text" id="node-input-twilioauthtoken" placeholder="Twilio Auth token">
            </div>
          </div>
          <div class="kumo-row" id='url'>
            <div class="kumo-row-with-margin" >
              <label class="kumo-row-label" for="node-input-url">URL</label>
              <input class="kumo-row-editable" type="text" id="node-input-url" placeholder="Webhook URL endpoint configured in Twilio platform">
            </div>
          </div>
          </div>
      </div>

</script>

<script type="text/x-kumologica" data-help-name="TwilioValidateRequest">
  <h4> Description </h4>
  <p>Twilio validate node validates the incoming request from Twilio webhook call. The validation is done against the Twilio signature using the Auth token.
    Validation ensure that the request is from Twilio platform and not from anywhere else.
  </p>

   <h4> Properties </h4>
   <ul>
   <li><i>Message</i> - (Optional). Inbound message from Twilio webhook call that needs to be validated.</li>
   <li><i>Signature</i> - (Required). Header that is a signed encoded string send from Twilio on webhook call.</li>
   <li><i>Auth Token</i> - (Required). Token provided by Twilio for your account in order to validate the signature.</li>
   <li><i>URL</i> - (Required). Endpoint hosted and shared to Twilio for webhook call.</li>
   </ul>

   <h4> Requirements </h4>
   512Mb is the minimum memory requirement for AWS Lambda deployments.

   <h4> Throws </h4>
   <ul>
     <li>TwilioError: Twilio validation check Failed</li>
   </ul>

   <h4> Returns </h4>
   The node returns a header with validation status as true or false. The request is valid if the status is <code>true</code> and is invalid if status is <code>false</code>. The header can be accessed using <code>msg.header.twilioreqstatus</code>.

   <h4> More info </h4>
   <a href="http://kumologica.com/">Kumologica Documentation</a>
</script>
